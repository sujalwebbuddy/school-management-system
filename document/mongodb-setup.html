<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MongoDB Setup ‚Äì SchoolHub Platform Docs</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./styles.css" />
    <script defer src="./script.js"></script>
  </head>
  <body>
    <aside class="sidebar">
      <div class="brand">
        <img src="./screenshots/logo.svg" alt="Logo" />
        <div>
          <h1>SchoolHub Platform</h1>
          <p>Documentation v1.0</p>
        </div>
      </div>
      <nav>
        <a href="./index.html">Welcome</a>
        <a href="./how-to-use.html">User Guide</a>
        <a href="./push-to-github.html">How to push to GitHub</a>
        <a href="./install-vercel.html">How to install on Vercel</a>
        <a href="./install-aws-ec2.html">How to install on AWS EC2</a>
        <a href="./database.html">How to setup Authentication</a>
        <a class="active" href="./mongodb-setup.html">How to create MongoDB Database</a>
        <a href="./env-setup.html">Environment Variables</a>
        <a href="./frontend-updates.html">Frontend Customization</a>
        <a href="./pricing-and-validations.html">User Roles & Permissions</a>
      </nav>
      <footer>
        <small>Database configuration guide</small>
      </footer>
    </aside>

    <main class="content">
      <header class="topbar">
        <h2>MongoDB Database Setup</h2>
      </header>

      <section class="prose">
        <div class="callout">
          <strong>üóÑÔ∏è About MongoDB:</strong> SchoolHub Platform uses MongoDB with Mongoose ODM to store all core entities: user accounts with roles, classes, subjects, homework assignments, submissions, chat messages, and tasks. Use MongoDB Atlas for a managed cloud deployment or self-host MongoDB locally.
        </div>

        <h3>Why MongoDB?</h3>
        <ul>
          <li><strong>Flexible schema:</strong> Handles nested data structures for classes, homework, and user relationships without complex migrations.</li>
          <li><strong>Great DX:</strong> Works seamlessly with Node.js and Mongoose ODM for easy data modeling.</li>
          <li><strong>Scalable:</strong> Atlas free tier (M0) is perfect for development; scale to larger clusters for production workloads.</li>
          <li><strong>JSON documents:</strong> Records mirror the data shapes consumed by the dashboard and API routes.</li>
        </ul>

        <h2>Option 1 ¬∑ MongoDB Atlas (Recommended)</h2>

        <h3>1. Create an Atlas cluster</h3>
        <ol class="steps">
          <li class="step">Visit <a href="https://www.mongodb.com/atlas" target="_blank" rel="noopener">mongodb.com/atlas</a> and create an account.</li>
          <li class="step">Pick the free M0 tier, choose AWS as the provider, and select a nearby region.</li>
          <li class="step">Click ‚ÄúCreate‚Äù and wait for Atlas to provision your cluster.</li>
        </ol>

        <h3>2. Add a database user</h3>
        <ol class="steps">
          <li class="step">Atlas sidebar ‚Üí <strong>Database Access</strong> ‚Üí ‚ÄúAdd New Database User‚Äù.</li>
          <li class="step">Authentication method = Password. Provide a strong username and password.</li>
          <li class="step">Grant ‚ÄúRead and write to any database‚Äù (you can scope to a single DB later).</li>
        </ol>

        <h3>3. Configure network access</h3>
        <ol class="steps">
          <li class="step">Atlas sidebar ‚Üí <strong>Network Access</strong> ‚Üí ‚ÄúAdd IP Address‚Äù.</li>
          <li class="step">During development you can temporarily allow <code>0.0.0.0/0</code>.</li>
          <li class="step">For production, whitelist only your server or Vercel IP ranges.</li>
        </ol>

        <h3>4. Grab the connection URI</h3>
        <ol class="steps">
          <li class="step">Atlas sidebar ‚Üí <strong>Database</strong> ‚Üí ‚ÄúConnect‚Äù ‚Üí ‚ÄúConnect your application‚Äù.</li>
          <li class="step">Copy the SRV URI and replace <code>&lt;username&gt;</code>, <code>&lt;password&gt;</code>, and the database name.</li>
        </ol>

        <div class="code"><pre><code>mongodb+srv://dbUser:dbPassword@cluster0.xzy.mongodb.net/schoolhub?retryWrites=true&w=majority</code></pre></div>

        <div class="callout success">
          <strong>‚úÖ Tip:</strong> Use <code>schoolhub</code> as the default database name for consistency.
        </div>

        <h3>5. Add the URI to <code>.env.local</code></h3>
        <div class="code"><pre><code># Project root /.env.local
MONGODB_URI=mongodb+srv://dbUser:dbPassword@cluster0.xzy.mongodb.net/schoolhub?retryWrites=true&w=majority</code></pre></div>

        <h2>Option 2 ¬∑ Local MongoDB</h2>
        <ol class="steps">
          <li class="step">Install MongoDB Community Server (macOS: <code>brew install mongodb-community</code>).</li>
          <li class="step">Start the daemon (<code>brew services start mongodb-community</code> or systemd).</li>
          <li class="step">Create the <code>schoolhub</code> database via Compass or <code>mongosh</code>.</li>
        </ol>
        <div class="code"><pre><code>MONGODB_URI=mongodb://localhost:27017/schoolhub</code></pre></div>

        <h2>Collections Created by Mongoose Models</h2>
        <table>
          <thead>
            <tr>
              <th>Collection</th>
              <th>Purpose</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>users</code></td>
              <td>User profiles with roles (admin/teacher/student), approval status, and personal information.</td>
            </tr>
            <tr>
              <td><code>classes</code></td>
              <td>Class information, names, and associated data.</td>
            </tr>
            <tr>
              <td><code>subjects</code></td>
              <td>Subject information and teacher assignments.</td>
            </tr>
            <tr>
              <td><code>homeworks</code></td>
              <td>Homework assignments with deadlines, descriptions, and attached files.</td>
            </tr>
            <tr>
              <td><code>homeworksubmissions</code></td>
              <td>Student homework submissions with files and grades.</td>
            </tr>
            <tr>
              <td><code>chats</code></td>
              <td>Chat conversations between users.</td>
            </tr>
            <tr>
              <td><code>messages</code></td>
              <td>Individual messages within chat conversations.</td>
            </tr>
            <tr>
              <td><code>tasks</code></td>
              <td>Task management with priorities and deadlines.</td>
            </tr>
          </tbody>
        </table>

        <div class="callout info">
          <strong>üîç Inspect data quickly:</strong> Use MongoDB Compass to connect with your connection string, or use <code>mongosh</code> command line tool to query your database.
        </div>

        <h2>Testing the Connection</h2>
        <ol class="steps">
          <li class="step">Install dependencies: <code>cd server && npm install</code>.</li>
          <li class="step">Set MONGODB_URI in your <code>.env</code> file.</li>
          <li class="step">Start the server: <code>npm start</code>.</li>
          <li class="step">Create a user account ‚Äî you should see new documents inside the <code>users</code> collection.</li>
        </ol>

        <h2>Troubleshooting</h2>
        <div class="callout warning">
          <strong>Common issues:</strong>
          <ul>
            <li><strong>Authentication failed:</strong> Double-check the username/password embedded in <code>DATABASE_URL</code>.</li>
            <li><strong>IP not allowed:</strong> Update Network Access in Atlas so your server/Vercel IP can connect.</li>
            <li><strong>Schema mismatch:</strong> Ensure Mongoose models match your database structure. Models are defined in <code>server/models/</code>.</li>
            <li><strong>Timeouts:</strong> Attempt to connect with <code>mongosh</code> locally to ensure DNS + firewall rules are correct.</li>
          </ul>
        </div>

        <h2>Backups & Security</h2>
        <ul>
          <li>Enable Atlas snapshots or schedule <code>mongodump</code> exports for self-hosted deployments.</li>
          <li>Rotate database user passwords and avoid embedding secrets directly in source code.</li>
          <li>Restrict Network Access to trusted IP ranges before going live.</li>
        </ul>

        <div class="callout success">
          <strong>üéâ All set!</strong> Your MongoDB cluster is ready. Continue with the <a href="./env-setup.html">Environment Variables</a> or <a href="./database.html">Authentication</a> guide to finish the backend setup.
        </div>
      </section>
    </main>
  </body>
</html>
